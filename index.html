<!DOCTYPE html>
<html>
<head>
  <title>Parsons Problem Builder</title>
  <style>
    .container { display: flex; gap: 20px; margin-top: 20px; }
    .box { border: 1px solid #ccc; padding: 10px; width: 45%; min-height: 200px; }
    .line {
      background: #f0f0f0;
      margin: 5px;
      padding: 5px;
      cursor: grab;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .code-text {
      flex-grow: 1;
      white-space: pre;
    }
    .indent-btns {
      display: flex;
      gap: 5px;
    }
    button.small {
      font-size: 0.8em;
      padding: 2px 6px;
    }
    textarea {
      width: 100%;
      height: 100px;
      font-family: monospace;
    }
  </style>
</head>
<body>

<h2>Enter code to turn into a Parsons Problem</h2>
<textarea id="codeInput" placeholder="Paste your code here..."></textarea><br>
<button onclick="generateProblem()">Generate</button>

<div class="container">
  <div class="box" id="choices"></div>
  <div class="box" id="workspace"></div>
</div>

<button onclick="checkAnswer()">Check</button>
<p id="result"></p>

<script>
  let correctLines = [];

  function generateProblem() {
    const code = document.getElementById("codeInput").value.trim();
    if (!code) return;

    const lines = code.split("\n").map(line => {
      const match = line.match(/^(\s*)(.*)$/);
      const indent = match[1].length / 4; // assume 4 spaces per indent
      return { indent: Math.floor(indent), text: match[2] };
    });

    correctLines = lines;

    // Clear boxes
    document.getElementById("choices").innerHTML = "";
    document.getElementById("workspace").innerHTML = "";
    document.getElementById("result").textContent = "";

    // Shuffle lines
    const shuffled = [...lines].sort(() => Math.random() - 0.5);

    shuffled.forEach((line, idx) => {
      const lineDiv = createLineElement(line.text, "line-" + idx);
      document.getElementById("choices").appendChild(lineDiv);
    });
  }

  function createLineElement(text, id) {
    const lineDiv = document.createElement("div");
    lineDiv.className = "line";
    lineDiv.draggable = true;
    lineDiv.id = id;
    lineDiv.dataset.indent = 0;

    const codeSpan = document.createElement("span");
    codeSpan.className = "code-text";
    codeSpan.textContent = text;
    lineDiv.appendChild(codeSpan);

    const btnContainer = document.createElement("div");
    btnContainer.className = "indent-btns";

    const indentBtn = document.createElement("button");
    indentBtn.className = "small";
    indentBtn.textContent = "➕";
    indentBtn.onclick = (e) => {
      e.stopPropagation();
      adjustIndent(lineDiv, +1);
    };

    const unindentBtn = document.createElement("button");
    unindentBtn.className = "small";
    unindentBtn.textContent = "➖";
    unindentBtn.onclick = (e) => {
      e.stopPropagation();
      adjustIndent(lineDiv, -1);
    };

    btnContainer.appendChild(indentBtn);
    btnContainer.appendChild(unindentBtn);
    lineDiv.appendChild(btnContainer);

    lineDiv.addEventListener("dragstart", (e) => {
      e.dataTransfer.setData("text/plain", lineDiv.id);
    });

    return lineDiv;
  }

  function adjustIndent(lineDiv, change) {
    let indent = parseInt(lineDiv.dataset.indent || "0");
    indent = Math.max(0, indent + change);
    lineDiv.dataset.indent = indent;
    const codeSpan = lineDiv.querySelector(".code-text");
    codeSpan.style.marginLeft = `${indent * 20}px`;
  }

  // Setup drag and drop for both boxes
  [document.getElementById("choices"), document.getElementById("workspace")].forEach(box => {
    box.addEventListener("dragover", (e) => e.preventDefault());
    box.addEventListener("drop", (e) => {
      e.preventDefault();
      const id = e.dataTransfer.getData("text/plain");
      const dragged = document.getElementById(id);
      box.appendChild(dragged);
    });
  });

  function checkAnswer() {
    const studentLines = Array.from(document.getElementById("workspace").children).map(div => {
      const indent = parseInt(div.dataset.indent || "0");
      const text = div.querySelector(".code-text").textContent.trim();
      return { indent, text };
    });

    const correct = studentLines.length === correctLines.length &&
      studentLines.every((line, i) =>
        line.text === correctLines[i].text &&
        line.indent === correctLines[i].indent
      );

    document.getElementById("result").textContent = correct ? "✅ Correct!" : "❌ Try again.";
  }
</script>

</body>
</html>
